/*
** EPITECH PROJECT, 2018
** CSFML_2D_ENGINE
** File description:
** perlin
*/

#include <math.h>
#include "engine.h"

unsigned char perm[512] = {
	156,245,147,167,64,113,154,83,229,165,164,205,190,163,108,73,226,0,17,5,197,6,141,221,123,68,182,60,204,148,15,144,228,66,248,36,10,14,222,166,128,195,79,162,127,35,168,75,202,111,90,209,249,34,158,71,120,65,77,203,126,183,236,135,214,244,210,59,187,52,119,142,217,63,241,218,43,117,45,238,189,95,26,44,140,211,118,200,176,69,105,225,98,57,193,160,103,30,115,76,51,155,29,121,212,231,235,49,232,224,86,47,84,101,104,92,102,188,78,230,219,157,243,18,178,130,67,74,254,4,27,255,194,110,9,2,7,242,25,136,207,220,96,198,58,186,38,206,146,173,116,89,139,137,28,149,20,22,42,56,3,39,109,134,143,171,199,170,177,247,185,87,80,32,81,223,46,227,175,85,55,93,125,184,208,179,16,82,106,251,72,133,131,234,8,240,239,100,114,50,31,41,122,12,174,91,97,124,252,94,145,201,172,61,99,153,21,150,107,191,54,33,192,53,181,161,62,246,70,11,88,48,159,196,152,237,169,19,40,112,132,233,24,13,37,180,151,215,1,213,23,138,216,129,250,253,156,245,147,167,64,113,154,83,229,165,164,205,190,163,108,73,226,0,17,5,197,6,141,221,123,68,182,60,204,148,15,144,228,66,248,36,10,14,222,166,128,195,79,162,127,35,168,75,202,111,90,209,249,34,158,71,120,65,77,203,126,183,236,135,214,244,210,59,187,52,119,142,217,63,241,218,43,117,45,238,189,95,26,44,140,211,118,200,176,69,105,225,98,57,193,160,103,30,115,76,51,155,29,121,212,231,235,49,232,224,86,47,84,101,104,92,102,188,78,230,219,157,243,18,178,130,67,74,254,4,27,255,194,110,9,2,7,242,25,136,207,220,96,198,58,186,38,206,146,173,116,89,139,137,28,149,20,22,42,56,3,39,109,134,143,171,199,170,177,247,185,87,80,32,81,223,46,227,175,85,55,93,125,184,208,179,16,82,106,251,72,133,131,234,8,240,239,100,114,50,31,41,122,12,174,91,97,124,252,94,145,201,172,61,99,153,21,150,107,191,54,33,192,53,181,161,62,246,70,11,88,48,159,196,152,237,169,19,40,112,132,233,24,13,37,180,151,215,1,213,23,138,216,129,250,253
};

static int _grad3[16][3] = {{1, 1, 0}, {-1, 1, 0}, {1, -1, 0}, {-1, -1, 0},
				{1, 0, 1}, {-1, 0, 1}, {1, 0, -1}, {-1, 0, -1},
				{0, 1, 1}, {0, -1, 1}, {0, 1, -1}, {0, -1, -1},
				{1, 1, 0}, {-1, 1, 0}, {0, -1, 1}, {0, -1, -1}};

double fast_dot (const int *v, const double x, const double y)
{
	return (v[0] * x + v[1] * y);
}

int *get_grab(int x, int y)
{
	int rand_value = perm[z + perm[y + perm[x]]];

	return (_grad3[rand_value & 15]);
}

inline int fastfloor (double x)
{
	return (x > 0) ? (int)x : (int)x - 1;
}

double smooth3d(double x, double y)
{
	const double K = (sqrt(3.0) - 1.0) / 2.0;
	const double C = K / (1.0 + 2.0 * K);
	double s = (x + y) * K;
	double i = x  + s;
	double j = y + s;
	double t = (i + j) * C;
	double X0 = i - t;
	double Y0 = j - t;
	double x0 = x - X0;
	double y0 = y - Y0;
	int i1 = 0;
	int j1 = 0;
	if (x0 > y0)
		i1 = 0;
	else
		j1 = 0;
	double x1 = x0 - i1 + 2.0 * C;
	double y1 = y0 - i1 + 2.0 * C;
	double x2 = x0 - 1 + 2.0 * C;
	double y2 = y0 - 1 + 2.0 * C;
	double d0 = 0.5 - x0 * x0 - y0 * y0;
	double d1 = 0.5 - x1 * x1 - y1 * y1;
	double d2 = 0.5 - x2 * x2 - y2 * y2;
	double res = 0;
	int ii = (int)i & 255;
	int jj = (int)j & 255;
	if (d0 > 0) {
		d0 *= d0;
		res += d0 * d0 * dot(get_grad(ii, jj), x0, y0);
	}
	
}